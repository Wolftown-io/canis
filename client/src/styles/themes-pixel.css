/**
 * Press Start 2P — 8-bit Pixel Font
 * License: SIL Open Font License 1.1 (OFL)
 * Source: https://fonts.google.com/specimen/Press+Start+2P
 * Author: CodeMan38
 * Bundled locally to avoid network dependency and FOUT on theme switch.
 */
@font-face {
  font-family: "Press Start 2P";
  src: url("/fonts/PressStart2P-Regular.woff2") format("woff2");
  font-weight: 400;
  font-style: normal;
  font-display: block;
}

/**
 * VT323 — Pixel/Terminal Font
 * License: SIL Open Font License 1.1 (OFL)
 * Source: https://fonts.google.com/specimen/VT323
 * Author: Peter Hull
 * Alternative pixel font that renders crisper on modern displays.
 */
@font-face {
  font-family: "VT323";
  src: url("/fonts/VT323-Regular.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: block;
}

/**
 * Pixel Theme Family — Structural Overrides
 *
 * These styles apply to ALL pixel-* themes via [data-theme^="pixel-"].
 * Each pixel theme variant only needs to define its own colors in themes.css.
 * Fonts, shapes, textures, and behaviors are shared across the family.
 *
 * HOW TO ADD A PIXEL THEME VARIANT:
 * 1. Add your theme ID (e.g. "pixel-dungeon") to THEME_NAMES in types.ts
 * 2. Add a ThemeDefinition entry with family: "pixel" in theme.ts
 * 3. Add a color block in themes.css with :root[data-theme="pixel-dungeon"]
 * 4. Done — structural styles below are inherited automatically
 *
 * SECTIONS:
 * 1. Structural tokens (radii, borders, shadows)
 * 2. Typography (pixel font sizing and application)
 * 3. Dithered textures (background patterns)
 * 4. Animations (stepped instead of smooth)
 * 5. Scrollbar styling
 */

/* ============================================================================
 * 1. Structural Tokens
 * Override shape tokens for sharp, blocky pixel appearance.
 * These are consumed by UnoCSS via the theme config in uno.config.ts.
 * ============================================================================ */
:root[data-theme^="pixel-"] {
  /* Sharp corners — pixel art doesn't have smooth curves */
  --radius-sm: 0;
  --radius-md: 0;
  --radius-lg: 2px;
  --radius-xl: 2px;
  --radius-full: 2px;

  /* Thicker borders for chunky pixel look */
  --border-width: 2px;

  /* No shadows — pixel art uses hard edges */
  --shadow-sm: none;
  --shadow-md: none;
}

/* ============================================================================
 * 2. Typography
 * Pixel font sizing and selective application.
 * Note: The actual @font-face for Press Start 2P is in a separate task.
 * Until that's done, this falls back to monospace.
 * ============================================================================ */
:root[data-theme^="pixel-"] {
  /* Pixel font for UI chrome, system font for content */
  /* VT323 renders crisper than Press Start 2P on modern displays */
  --font-ui: "VT323", "Press Start 2P", monospace;
  --font-content:
    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial,
    sans-serif;
}

/*
 * VT323 renders well at larger sizes (16px+). Use integer pixel sizes.
 * Fallback Press Start 2P works best at 8px multiples (8, 16, 24, 32).
 */

/* Apply pixel font to UI elements with INTEGER pixel sizes */
[data-theme^="pixel-"] h1 {
  font-family: var(--font-ui);
  font-size: 28px;
  line-height: 1.4;
  letter-spacing: 1px;
}

[data-theme^="pixel-"] h2 {
  font-family: var(--font-ui);
  font-size: 22px;
  line-height: 1.4;
  letter-spacing: 1px;
}

[data-theme^="pixel-"] h3,
[data-theme^="pixel-"] h4 {
  font-family: var(--font-ui);
  font-size: 18px;
  line-height: 1.4;
  letter-spacing: 1px;
}

[data-theme^="pixel-"] button,
[data-theme^="pixel-"] [class*="btn"] {
  font-family: var(--font-ui);
  font-size: 16px;
  line-height: 1.4;
  letter-spacing: 1px;
}

/* Sidebar and navigation elements */
[data-theme^="pixel-"] nav,
[data-theme^="pixel-"] [class*="sidebar"] [class*="header"],
[data-theme^="pixel-"] [class*="channel-name"],
[data-theme^="pixel-"] [class*="guild-name"] {
  font-family: var(--font-ui);
  font-size: 16px;
  line-height: 1.4;
  letter-spacing: 1px;
}

/* Keep readable font for content */
[data-theme^="pixel-"] [class*="message-content"],
[data-theme^="pixel-"] [class*="chat-message"],
[data-theme^="pixel-"] textarea,
[data-theme^="pixel-"] input[type="text"],
[data-theme^="pixel-"] input[type="search"],
[data-theme^="pixel-"] input[type="password"],
[data-theme^="pixel-"] input[type="email"],
[data-theme^="pixel-"] [contenteditable] {
  font-family: var(--font-content);
  font-size: 0.875rem;
  line-height: 1.5;
}

/* ============================================================================
 * 3. Dithered Textures
 * Classic pixel art dithering patterns as CSS backgrounds.
 * Uses tiny inline data URIs for the patterns.
 * ============================================================================ */

/*
 * Dither patterns encoded as data URIs:
 * - checkerboard: 2x2 alternating pixels
 * - light: 4x4 with sparse dots
 * - heavy: 4x4 with dense dots
 */
:root[data-theme^="pixel-"] {
  /* Checkerboard pattern (2x2) */
  --dither-check: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAEklEQVQIW2NkYGD4z8DAwMgAABFaAQVTpfV3AAAAAElFTkSuQmCC");

  /* Light dither (4x4 sparse) */
  --dither-light: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAFklEQVQIW2NkYGD4z8DAwMiABBgZGQEAGGIBBbYIe4IAAAAASUVORK5CYII=");

  /* Heavy dither (4x4 dense) */
  --dither-heavy: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAHUlEQVQIW2NkYGD4z8DAwMjAwMDIgAQYGBgYGAAAfwQFA+HwqvkAAAAASUVORK5CYII=");
}

/* Subtle dither overlay on sidebar — use ::after to avoid affecting children */
[data-theme^="pixel-"] [class*="server-rail"],
[data-theme^="pixel-"] [class*="sidebar"][class*="channel"] {
  position: relative;
}

[data-theme^="pixel-"] [class*="server-rail"]::after,
[data-theme^="pixel-"] [class*="sidebar"][class*="channel"]::after {
  content: "";
  position: absolute;
  inset: 0;
  background-image: var(--dither-check);
  background-size: 4px 4px;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
  opacity: 0.03;
  pointer-events: none;
  z-index: 0;
}

/* ============================================================================
 * 4. Animations
 * Stepped transitions instead of smooth easing for retro feel.
 * Applied sparingly to avoid performance issues.
 * ============================================================================ */
[data-theme^="pixel-"] button,
[data-theme^="pixel-"] [class*="btn"],
[data-theme^="pixel-"] [class*="item"]:hover {
  transition-timing-function: steps(4, end);
}

/* ============================================================================
 * 5. Scrollbar Styling
 * Chunky, square scrollbars matching pixel aesthetic.
 * ============================================================================ */
[data-theme^="pixel-"] ::-webkit-scrollbar {
  width: 12px;
}

[data-theme^="pixel-"] ::-webkit-scrollbar-track {
  background: var(--color-surface-base);
  border-left: 2px solid var(--color-border-default);
}

[data-theme^="pixel-"] ::-webkit-scrollbar-thumb {
  background: var(--color-surface-highlight);
  border: 2px solid var(--color-border-default);
}

[data-theme^="pixel-"] ::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-secondary);
}

/* Firefox scrollbar styling */
[data-theme^="pixel-"] * {
  scrollbar-width: auto;
  scrollbar-color: var(--color-surface-highlight) var(--color-surface-base);
}

/* ============================================================================
 * 6. Crisp Pixel Rendering
 * Force sharp rendering for pixel fonts and images.
 * Key: Use integer pixel sizes and avoid transforms that cause subpixel rendering.
 * ============================================================================ */

/* Pixelated rendering for images (icons, avatars, etc.) */
[data-theme^="pixel-"] img,
[data-theme^="pixel-"] svg {
  image-rendering: pixelated;
  image-rendering: crisp-edges;
}

/* VT323 renders crisply without hacks - only keep geometric precision */
[data-theme^="pixel-"] h1,
[data-theme^="pixel-"] h2,
[data-theme^="pixel-"] h3,
[data-theme^="pixel-"] h4,
[data-theme^="pixel-"] button,
[data-theme^="pixel-"] [class*="btn"],
[data-theme^="pixel-"] nav,
[data-theme^="pixel-"] [class*="sidebar"] [class*="header"],
[data-theme^="pixel-"] [class*="channel-name"],
[data-theme^="pixel-"] [class*="guild-name"] {
  text-rendering: geometricPrecision;
}

/* ============================================================================
 * 7. Font Weight Handling
 * VT323 only has one weight. Disable font synthesis to prevent blurry faux-bold.
 * Style bold text with color/size instead of weight.
 * ============================================================================ */
[data-theme^="pixel-"] {
  /* Prevent browser from synthesizing bold/italic - causes blur */
  font-synthesis: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Override bold to use regular weight with accent color instead */
[data-theme^="pixel-"] b,
[data-theme^="pixel-"] strong,
[data-theme^="pixel-"] .font-bold,
[data-theme^="pixel-"] .font-semibold,
[data-theme^="pixel-"] [class*="font-bold"],
[data-theme^="pixel-"] [class*="font-semibold"] {
  font-weight: 400 !important;
  font-synthesis: none;
  /* Use accent color to indicate emphasis instead of weight */
  color: var(--color-text-primary);
}
