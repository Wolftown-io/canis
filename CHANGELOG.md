# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Fixed
- Favorite star button not responding to clicks in channel list (#152)
  - Fixed invalid nested `<button>` HTML structure in ChannelItem that prevented click events from reaching the star toggle
  - Converted outer channel button to a `<div>` with proper `role="button"` and keyboard accessibility
- File attachment uploads in text chat (#149)
  - Fixed AWS SDK panic when initializing S3 client (missing tokio sleep implementation)
  - MinIO bucket now automatically initialized in development environment
  - Added comprehensive file uploads documentation (docs/development/file-uploads.md)
  - Added MinIO initialization script (scripts/init-minio.sh)
  - Updated setup guide with file upload configuration steps

### Added
- Message input enhancements for improved UX
  - Multi-line textarea with auto-resize (min 1 line, max 8 lines)
  - Shift+Enter for newlines, Enter to send
  - IME composition support for CJK input (Chinese, Japanese, Korean)
  - Persistent drafts with localStorage (auto-saves every 300ms, max 50 drafts with LRU eviction)
  - Drafts skip E2EE channels to prevent plaintext leaks
  - Proper cleanup of draft event listeners on logout to prevent memory leaks
  - Graceful localStorage quota exceeded handling (auto-reduces to 25 drafts and retries)
  - Quick message actions toolbar (hover to reveal: 4 quick emojis + emoji picker + context menu)
  - @user autocomplete with arrow key navigation (works in both guild channels and DMs)
  - Prefix matches prioritized in autocomplete results for better relevance
  - :emoji: autocomplete with support for both standard and custom guild emojis
  - False positive prevention for autocomplete (ignores email addresses, times, URLs)
  - Smart positioning for autocomplete popup using floating-ui with autoUpdate
  - Autocomplete closes when clicking away from trigger in textarea
  - Full ARIA support for autocomplete popup (role="listbox", aria-activedescendant, aria-selected)
  - ARIA labels for all message action buttons (emoji reactions, picker, context menu)

### Added
- Channel-level permission system (VIEW_CHANNEL)
  - New VIEW_CHANNEL permission bit (bit 24) controls channel visibility and access
  - Users must have VIEW_CHANNEL to see channels in lists, read messages, or interact with channels
  - Permission checks integrated across all major endpoints (22+ endpoints):
    - Search: Filters channels by VIEW_CHANNEL before searching messages
    - Channel retrieval: GET /api/channels/:id requires VIEW_CHANNEL
    - Message operations: List, create, edit, delete messages all require VIEW_CHANNEL
    - Reactions: Add, remove, and list reactions require VIEW_CHANNEL
    - Typing indicators: Both start and stop typing require VIEW_CHANNEL
    - Voice operations: Join requires VOICE_CONNECT, leave/mute require VIEW_CHANNEL
    - Screen sharing: Start requires SCREEN_SHARE permission
    - Favorites: Add/remove favorites requires VIEW_CHANNEL
  - Message sending also validates SEND_MESSAGES permission for guild channels
  - Voice channel join validates both VIEW_CHANNEL and VOICE_CONNECT permissions
  - Database migration adds VIEW_CHANNEL to all existing roles for backward compatibility
  - Channel permission overrides (allow/deny) fully supported for granular access control
  - DM channels remain accessible only to participants (no guild permissions apply)
  - Guild owners bypass all channel-level restrictions
  - Comprehensive integration tests (18 tests covering all permission scenarios)
  - Detailed documentation with mermaid diagrams (docs/features/channel-permissions.md)

### Added
- New `BLOCK_CHECK_FAIL_OPEN` configuration option for Redis block check behavior
  - When false (default, recommended): Block checks fail-closed, rejecting DMs/calls if Redis is unavailable (secure default)
  - When true: Block checks fail-open, allowing actions if Redis is unavailable (prioritizes availability over security)
  - Affects DM creation, DM message sending, call initiation, and call joining
  - Provides explicit control over availability vs security tradeoff during Redis outages

### Changed
- Documentation audit and cleanup
  - Updated all version numbers in standards.md to match actual dependencies
  - Updated project specification status to Phase 4
  - Fixed architecture diagrams (removed mediasoup, nnnoiseless references)
  - Removed resolved tech debt and stale persona review sections from architecture overview
  - Fixed broken internal documentation links across all docs

### Removed
- Deleted 12 stale documentation files (session artifacts, redundant license docs, completed update checklists, dependency snapshots)
- Removed phantom dependencies from standards documentation (jsonrpsee, nnnoiseless, metrics, x25519-dalek, ed25519-dalek)
- Removed stale scripts (resume-session.sh, update-deps.sh)

### Added
- PostgreSQL native full-text search for guild messages
  - Backend: tsvector column with GIN index for fast full-text search using `websearch_to_tsquery`
  - Backend: Guild-scoped search API with permission validation and pagination (`GET /api/guilds/:id/search`)
  - Backend: Bulk user/channel lookup optimization to prevent N+1 queries
  - Frontend: Search panel overlay with debounced input (300ms) and XSS-safe result highlighting
  - Frontend: Click-to-navigate to messages with highlight parameter support
  - Migration: `content_search` generated column with automatic updates on message edits
- Absolute user blocking with server-side enforcement
  - Block/unblock via context menu with confirmation modal
  - Blocked users cannot send DMs, friend requests, or initiate calls
  - Messages from blocked users are filtered in channel message lists
  - WebSocket events (typing, presence, messages) from blocked users are filtered in real-time
  - Redis SET-based block cache for low-latency enforcement
  - Block/unblock WebSocket events for instant client-side sync
- User reporting system
  - Users can report other users or specific messages (harassment, spam, inappropriate content, impersonation, other)
  - Rate-limited to 5 reports per hour, with duplicate prevention for active reports
  - Admin report queue with status/category filters and pagination
  - Admin actions: claim, resolve (dismiss/warn/ban/escalate)
  - Real-time admin notifications via WebSocket when new reports are created
  - Report statistics dashboard with counts by status
- Integration tests for blocking and reporting (25 tests)
  - 8 blocking tests: block/unblock, auth, self-block, prevents friend request/DM/message
  - 6 report tests: create, auth, self-report, invalid target/category, duplicate
  - 11 admin report tests: access control, list/filter, get, claim, resolve, stats
  - Shared test helpers: `create_friendship`, `create_dm_channel`, `create_elevated_session`, `create_test_report`
- Fixed friend list query bug where wrong column names prevented friends from loading
- SSO/OIDC authentication integration
  - Admin-configurable identity providers (GitHub, Google, custom OIDC/OAuth2)
  - PKCE S256 + state + nonce security for all flows
  - Client secrets encrypted at rest (AES-256-GCM)
  - Preset support for GitHub and Google with auto-filled endpoints
  - Admin settings panel for auth methods, registration policy, and provider CRUD
  - Login/Register views show SSO buttons when providers are configured
  - Registration policy enforcement (open, invite-only, closed)
  - Browser popup flow with postMessage token delivery
  - Username generation from OIDC claims with collision handling
- Screen share Tauri WebSocket event parity
  - ScreenShareStarted, ScreenShareStopped, ScreenShareQualityChanged variants in Tauri ServerEvent
  - Event forwarding to frontend via ws:screen_share_* events
- Screen share viewer keyboard shortcuts
  - Escape to close viewer, V to cycle view mode, M to toggle mute, F for spotlight/fullscreen
  - Input element guard to avoid conflicts when typing
- Screen share test coverage
  - Server event serialization tests (screenshare_test.rs)
  - Client WebSocket handler tests calling actual exported handlers (websocketScreenShare.test.ts)
- Component testing infrastructure for Solid.js
  - Vitest configuration with vite-plugin-solid
  - Test setup with automatic cleanup between tests
  - Initial tests for Skeleton and UnreadModule components
- Tauri WebSocket event parity improvements
  - Unread count tracking in Tauri mode (matches browser mode)
  - Voice event listeners for full voice chat support in Tauri
  - GitHub issue #132 filed to track 22 missing ServerEvent variants for full parity
- Global toast notifications for user feedback
  - Max 5 visible toasts with auto-dismiss of oldest
  - Error toasts for failed operations (message send, mark as read, etc.)
  - Success toasts for completed actions (avatar upload, settings saved, role/channel created)

### Fixed
- Clippy warnings in crypto and server modules
  - Suppress false-positive `missing_const_for_fn` lint in vc-crypto
  - Fix `many_single_char_names` in BGRA→I420 color conversion
  - Remove unnecessary raw string hashes in SQL queries

### Security
- Fixed channel permission bypass in favorites endpoint
  - Add favorite (POST /api/me/favorites/:channel_id) now validates VIEW_CHANNEL permission
  - Previously only checked guild membership, allowing users to favorite channels they couldn't view
  - Fixes potential information disclosure where channel existence could be inferred without proper access

### Changed
- Upgraded vite-plugin-solid to 2.11.10 for vitest 4 compatibility
- Upgraded vite to 7.3.1 for better tooling compatibility
- Native screen capture for Tauri desktop client
  - Source picker modal to select monitors or windows
  - VP9 software encoding with quality tiers (480p15 to 1080p60)
  - RTP packetization and delivery via WebRTC video track
  - Quality picker with low/medium/high/premium presets
  - Auto-stop screen share when leaving voice channel
  - Cross-platform via scap (ScreenCaptureKit, WGC, PipeWire)
- Forgot password workflow with SMTP email delivery
  - POST /auth/forgot-password — request reset code via email
  - POST /auth/reset-password — reset password with code
  - SMTP configuration (SMTP_HOST, SMTP_USERNAME, SMTP_PASSWORD, SMTP_FROM, SMTP_TLS)
  - Rate-limited endpoints (AuthPasswordReset category)
  - All sessions invalidated on successful password reset
  - No user enumeration (generic responses for unknown emails)
  - Frontend pages: /forgot-password and /reset-password
  - Background cleanup for expired reset tokens

### Changed
- Modernized dependencies across all workspace crates
  - axum 0.7→0.8, tower 0.4→0.5, tower-http 0.5→0.6, utoipa 4→5
  - fred 8→10 (Redis client), reqwest 0.11→0.13
  - vodozemac 0.5→0.9 (E2EE crypto)
  - cpal 0.15→0.17, rodio 0.19→0.21 (audio)
  - sysinfo 0.30→0.34 (game detection)
  - sqlx 0.7→0.8.6, rusqlite 0.29→0.32 (database)
  - thiserror 1→2, validator 0.16→0.20, pulldown-cmark 0.10→0.13
  - Removed unused x25519-dalek and ed25519-dalek crates

### Added
- Content spoilers with `||text||` syntax for hiding sensitive information
  - Click-to-reveal functionality with persistent reveal state
  - Supports markdown and inline spoilers
  - ReDoS protection (500 character limit)
  - XSS prevention via DOMPurify allowlist
- @everyone and @here mention permission control
  - New MENTION_EVERYONE permission bit (bit 23) for guild roles
  - Server-side validation prevents unauthorized mass mentions
  - Permission UI toggle in guild role settings
  - Forbidden for @everyone role by default (moderator+ permission)
- Home page unread aggregator in modular sidebar
  - Centralized view of unread messages across all guilds and DMs
  - Grouped by guild with channel-level unread counts
  - Direct navigation to channels with unread messages
  - Comprehensive error handling with user-friendly toast notifications
  - Automatic refresh when window gains focus (throttled to 30s intervals)
  - WebSocket real-time updates with debounced refetch on new messages
  - Skeleton loading UI matching content layout
  - Collapsible module with unread badge
  - API endpoint: `GET /api/me/unread`
  - Performance-optimized database query with covering indexes
- First user setup wizard with automatic admin bootstrap
  - First user to register automatically receives system admin permissions
  - Mandatory setup wizard for configuring server name, registration policy, and legal URLs
  - Setup completion is permanent and cannot be re-triggered (prevents takeover)
  - Transaction-based race condition prevention for concurrent first-user registrations
  - Setup status exposed in authentication responses (`setup_required` flag)
  - API endpoints: `GET /api/setup/status`, `GET /api/setup/config`, `POST /api/setup/complete`
- Right-click context menus for messages, channels, and users
  - Message menu: Copy Text, Copy Message Link, Copy ID, Delete (own messages)
  - Channel menu: Mark as Read, Mute/Unmute, Add to Favorites, Edit Channel, Copy ID
  - User menu: View Profile, Send Message, Add Friend, Block, Copy User ID
  - Keyboard navigation with Arrow keys, Enter, Home/End, and Escape
- Custom avatars for DM and Group DM conversations (#104)
  - Click avatar in conversation header to upload custom icon
  - Avatars visible in sidebar and conversation header
  - Works for both 1:1 DMs and group DMs
- Custom display name for group DMs (#91)
  - PATCH `/api/dm/:id/name` endpoint to rename group DMs
  - Inline editing in conversation header (click group name to edit)
  - Real-time name sync via WebSocket `dm_name_updated` event
- Join Server button in server rail with invite code/link input modal
- Pixel art theme system with "Pixel Cozy" warm earth-tone theme
- Theme family architecture allowing community theme variants
- Structural CSS tokens (radii, fonts, shadows) for theme-aware UI
- Dithered texture patterns for pixel theme backgrounds
- Press Start 2P pixel font for UI elements
- Theme creation guide (THEME_GUIDE.md) for community contributors
- Cross-family fade transition when switching between theme types
- Theme consistency tests for validating theme definitions
- WebSocket notifications for friend requests
  - Real-time notification when receiving a friend request
  - Real-time notification when a friend request is accepted
- Profile update endpoint (`POST /auth/me`) for changing display_name and email
- Real-time state synchronization via WebSocket patch events
  - Incremental updates for users, guilds, and members (only changed fields sent)
  - Automatic subscription to guild event channels for member updates
  - Client-side patch handlers with field validation
- Fedora Atomic (Silverblue/Kinoite) support in development setup scripts
  - Automatic detection of immutable Fedora systems
  - Distrobox-based development container with all dependencies
  - Optional rpm-ostree layering fallback (with reboot requirement)
  - Export of development tools (cargo, bun, sqlx) to host `~/.local/bin`
  - Podman support alongside Docker for container orchestration
- Full-text message search using PostgreSQL tsvector
  - Search messages within a guild using `websearch_to_tsquery` syntax (supports AND, OR, quotes)
  - GIN index for fast search performance
  - Search panel in sidebar with debounced input (300ms)
  - Results show channel name, author, timestamp, and highlighted content preview
  - Click results to navigate directly to the message
  - Pagination support with "Load more" for large result sets
- Cross-server favorites: pin channels from different guilds into a unified Favorites section
  - Star icon on channels to toggle favorites (appears on hover, filled when favorited)
  - Expandable Favorites section in Sidebar grouped by guild
  - Click favorites to navigate directly to that guild and channel
  - Maximum 25 favorites per user
  - Automatic cleanup when last channel from a guild is unfavorited
- Modular Home Sidebar with collapsible modules:
  - Active Now module shows friends currently playing games
  - Pending module with quick accept/decline for friend requests
  - Pins module for saving notes and links across devices
  - Module collapse state syncs across all devices via server preferences
- Server-synced user preferences
  - Theme, sound settings, quiet hours, and per-channel notifications sync across all devices
  - Real-time updates via WebSocket when preferences change on another device
  - Offline support with automatic sync on reconnect
  - Migration from legacy localStorage keys
- Cross-client read sync for DMs
  - When reading a DM on one device, unread badges clear on all other devices instantly
  - Uses new `user:{user_id}` Valkey channel for user-targeted events
  - Real-time synchronization via WebSocket
- Unread message tracking for guild channels
  - Unread badge on text channels shows count of unread messages (capped at 99+)
  - Auto-marks channel as read after 1 second when viewing
  - Cross-device sync: reading on one device clears badges on all devices
  - Category headers indicate when any channel within has unread messages
- Do Not Disturb mode for notifications
  - Notification sounds suppressed when user status is "Do Not Disturb" (Busy)
  - Scheduled quiet hours with configurable start/end times
  - Handles overnight ranges (e.g., 22:00 to 08:00)
  - Call ring sounds also suppressed during DND
  - Quiet Hours settings UI in Settings > Notifications
- DM voice calls client integration
  - Voice connection wiring: WebRTC starts after accepting/starting calls
  - Tauri commands for call lifecycle (start, join, decline, leave)
  - Ring sound notification with looping playback for incoming calls
  - Call indicator in DM sidebar with pulsing animation for incoming calls
- Clipboard protection system for secure copy/paste operations
  - ClipboardGuard service with SHA-256 hash-based tamper detection
  - Auto-clear timers based on sensitivity (Critical: 60s, Sensitive: 120s)
  - Paranoid mode with 30s timeout for all sensitive content
  - Protection levels: Minimal, Standard, Strict (configurable in Settings)
  - UI components: ClipboardToast, ClipboardIndicator, TamperWarningModal
  - Browser fallback support when not running in Tauri
  - Integration with recovery phrase and invite link copying
- Sound notification system for chat messages
  - 5 notification sounds: Default, Subtle, Ping, Chime, Bell
  - Global notification settings in Settings > Notifications tab
  - Per-channel notification levels: All messages, Mentions only, or Muted
  - Volume control with test sound button
  - Smart playback with cooldown, tab leader election (web), and mention detection
  - Native audio playback via rodio in Tauri, Web Audio API fallback in browser
  - Muted channel indicator (bell-off icon) in channel list
- Home View Overhaul with "Friends First" design
  - Unified `HomeSidebar` replacing the legacy double-sidebar layout
  - Default "Friends" landing view with filter search (Online/All/Pending/Blocked)
  - "Active Now" panel showing real-time friend activity (games, voice, etc.)
  - Information section for server-wide pages (Rules, Announcements)
  - Collapsible Direct Messages list sorted by recent activity
- Custom Avatars system
  - `POST /auth/me/avatar` endpoint with S3/MinIO storage backend
  - "My Account" settings tab with avatar upload and preview
  - Client-side validation for image type and size (5MB limit)
  - Instant profile update propagation across the UI
- Status Picker in User Panel (Online, Away, Do Not Disturb, Invisible)
- Rich Presence (Game Activity) showing "Playing X" status in member lists
  - Automatic game detection via process scanning (sysinfo crate)
  - 15+ pre-configured games (Minecraft, Valorant, League of Legends, CS2, Fortnite, etc.)
  - Activity display in guild member list, friends list, and DM panels
  - Privacy toggle in settings to disable activity sharing
  - Real-time activity sync via WebSocket
- Screen sharing capability in browser clients with quality selection (480p/720p/1080p)
- Screen share button in voice controls with quality picker dialog
- Screen share indicator on participant avatars in voice panel
- WebSocket event handlers for screen share state synchronization
- User feature flags system for premium feature control (PREMIUM_VIDEO)
- Quality enum for screen share quality tiers (Low/Medium/High/Premium)
- User Connectivity Monitor for real-time voice connection quality tracking
  - Live quality indicators (latency, packet loss, jitter) in VoiceIsland and participant list
  - Toast notifications for connection issues (warning at 3% loss, critical at 7%)
  - Connection History page (`/settings/connection`) with 30-day analytics
  - TimescaleDB storage with automatic compression and 7-day retention
- E2EE key management with Olm protocol using vodozemac library
- Recovery key generation with Base58 display format for user backup
- Encrypted key backup with AES-256-GCM and Argon2id key derivation
- Multi-device support with per-device identity keys
- One-time prekey upload and atomic claiming for session establishment
- E2EE Key Backup UI with recovery key modal, security settings, and setup prompts
  - Recovery key modal with copy/download and confirmation flow
  - Security Settings tab showing backup status
  - Post-login E2EE setup prompt (skippable or mandatory via server config)
  - Backup reminder banner for users without backup
  - Server configuration option `REQUIRE_E2EE_SETUP` for mandatory setup
- End-to-End Encrypted DM messaging
  - LocalKeyStore with encrypted SQLite storage for Olm accounts and sessions
  - CryptoManager for session management and encrypt/decrypt operations
  - Tauri commands for E2EE initialization, encryption, and decryption
  - E2EE store for frontend state management with Solid.js signals
  - E2EE setup modal with recovery key generation and secure clipboard integration
  - Encryption indicator (lock/unlock icon) in DM conversation headers
  - Graceful fallback to unencrypted messaging when E2EE not available
  - Automatic decryption of incoming encrypted messages
- Information Pages system for platform-wide and guild-specific content (ToS, Privacy Policy, FAQ, rules, guides)
- Markdown editor with live preview, toolbar, and cheat sheet
- Mermaid diagram support in markdown preview
- Page acceptance tracking with scroll-to-bottom requirement for mandatory pages
- Page ordering via drag-and-drop with position persistence
- Audit logging for all page operations (create, update, delete, reorder)
- CHANGELOG.md following keepachangelog.com format
- Changelog maintenance guidelines in CLAUDE.md
- Admin Dashboard with user management, guild oversight, and audit log viewing
- AdminQuickModal for quick admin access with elevation status and stats
- Session elevation system with MFA verification and 15-minute expiry
- Ban/unban users and suspend/unsuspend guilds (requires elevation)
- Admin panel Phase 1 improvements
  - User avatars and guild icons displayed in admin lists
  - Skeleton loading animations replacing text placeholders
  - Keyboard navigation (Arrow keys, Enter, Escape) in user/guild tables
- Admin panel Phase 2 improvements
  - Server-side search for users (by username, display name, email) and guilds (by name)
  - Debounced search input with 300ms delay for reduced API calls
  - Audit log advanced filters: date range picker and action type dropdown
  - Active filter indicators showing current filter state
- Admin panel Phase 3 improvements
  - User detail expansion showing last login, guild count, and guild memberships
  - Guild member preview with owner info and stacked avatar display of top members
  - Lazy-loaded detail panels to reduce initial load time
- Admin panel Phase 4 improvements
  - CSV export for users and guilds with current search/filter applied
  - Bulk ban users with checkbox selection and confirmation dialog
  - Bulk suspend guilds with multi-select and reason input
  - Select all / clear selection controls in bulk action bar
- Admin panel Phase 5 improvements
  - Real-time updates via WebSocket for admin actions (ban/unban, suspend/unsuspend)
  - Undo functionality with toast notifications for ban and suspend actions (5-second window)
  - Toast action buttons for immediate undo capability
  - Admin event subscription for elevated admins
- Screen share viewer with three view modes (Spotlight, PiP, Theater)
- Volume control for screen share audio
- Screen share list in voice panel showing active shares
- Click-to-view screen shares from participant indicators
- Voice quality indicators with real-time latency, packet loss, and jitter display
- Accessibility shapes (circle/triangle/hexagon) for colorblind-friendly status indicators
- User status picker with Online, Idle, Do Not Disturb, and Invisible options
- Custom status with emoji and auto-expiry timer
- Automatic idle detection after configurable inactivity timeout
- Message reactions with emoji picker
- Emoji search, recent emojis, and favorites support
- Guild custom emoji database schema and API
- Channel categories with 2-level folder hierarchy
- Collapsible category headers with unread indicators
- Drag-and-drop reordering for channels and categories
- Display preferences for indicator modes (dense/minimal/discord)
- Guild Emoji Manager
  - Custom guild emoji support with `MANAGE_EMOJIS_AND_STICKERS` permission
  - Animated emoji support (GIF, WebP)
  - Drag-and-drop upload in Guild Settings > Emojis tab
  - Bulk upload utility script (`scripts/upload_emojis.py`)
- Configurable file size limits for different upload types
  - `MAX_AVATAR_SIZE` environment variable for user and DM avatars (default: 5MB)
  - `MAX_EMOJI_SIZE` environment variable for guild custom emojis (default: 256KB)
  - `MAX_UPLOAD_SIZE` for message attachments (default: 50MB)
- Frontend validation helper function (`validateFileSize()`) for instant user feedback before upload
- User-friendly error messages showing both file size and limit in human-readable format (KB/MB)

### Changed
- **BREAKING:** Authentication responses now include `setup_required` boolean field
  - Affects `POST /auth/register`, `POST /auth/login`, and `POST /auth/refresh` endpoints
  - Existing clients must handle the new field or update their deserialization logic
  - Field indicates whether server setup wizard should be displayed
- JWT signing algorithm upgraded from HS256 → EdDSA (Ed25519) for stronger cryptographic security
- Infrastructure: Redis replaced with Valkey for open-source compatibility
- API error response format standardized across all endpoints (consistent error codes)
- Health endpoint now verifies database and Redis connectivity (returns "degraded" status on failure)
- Consolidated ThemeName type to single source of truth in types.ts
- UnoCSS theme config now uses CSS custom properties for border-radius and shadows
- StatusIndicator component now uses SVG shapes instead of colored dots
- UserStatus type extended from 4 to 5 statuses (added 'dnd')
- Improved UI contrast and accessibility
  - Fixed unreadable text in selected Settings tabs (high contrast text)
  - Updated error banners to use semantic theme tokens for better visibility
  - Added clearer separator lines in sidebars for visual hierarchy
  - Increased border visibility to `border-white/10` for main layout framing
- DM group avatar size limit reduced from 50MB to 5MB for consistency with user avatars
- Guild custom emoji size limit is now configurable (previously hardcoded at 256KB)
- Updated dependencies for compatibility and performance:
  - tokio-tungstenite 0.21 → 0.28 (WebSocket improvements)
  - reqwest: migrated from deprecated `rustls-tls` to `rustls` feature
  - Fixed breaking changes in tungstenite 0.28 Message::Text API
- Conducted comprehensive dependency audit (45+ dependencies reviewed)
  - Identified critical updates (sqlx, axum) and blockers
  - Phased update strategy executed in subsequent releases

### Deprecated

### Removed
- Legacy unscoped `GET /api/channels` endpoint that returned all channels across all guilds

### Fixed
- Screen share quality tier now rejects invalid values instead of silently defaulting to "medium"
- Eliminated redundant screen capture source lookup (was querying all targets twice per share start)
- Encoder shutdown now responds promptly to stop signal instead of blocking on next frame
- Removed unused RTP sequence tracking (handled by webrtc-rs internally)
- Pre-allocated I420 buffer in VP9 encoder to avoid per-frame heap allocation
- Emoji picker positioning and viewport clipping issues
  - Integrated @floating-ui/dom for smart positioning that adapts to available space
  - Picker now automatically flips up/down and shifts left/right to stay visible
  - Dynamic max-height adjustment based on viewport size
  - Click-outside and Escape key support for better UX
  - Portal-based rendering prevents clipping by parent containers
  - Smooth fade-in animation when picker appears
- Friend requests failing in desktop client (#107)
  - Removed dead Tauri `invoke()` branches for friend commands (no corresponding Rust commands existed)
  - All friend operations now use HTTP API consistently
- DM avatar upload now works in desktop client and updates reactively (#104)
- DM list now shows online status for 1:1 conversations using presence store
- Kick member button now properly checks KICK_MEMBERS permission
- Voice session finalization with retry logic for reliability
- Redis broadcast failures now logged instead of silently ignored
- VoiceStatsLimiter periodic cleanup prevents memory leaks
- Admin elevated session cache falls back to database on cache miss
- Pixel font rendering fixed (blurry text in pixel themes)
- Reaction API endpoints corrected with proper WebSocket handlers
- Message pagination cursor comparison corrected for stable ordering
- Message pagination cursor comparison corrected for stable ordering
- Server build failure fixed by adding `Deserialize` to `GuildEmoji`
- **Fixed**: Pinned notes functionality restored (fixed API wrapper implementation) (#105)
- Documentation formatting in admin handlers fixed
- Orphaned password reset tokens cleaned up when email send fails (#130)
- Removed unused `update_user_password` database function (#131)

### Security
- **CRITICAL FIX**: WebSocket event filtering race condition that could allow blocked users' messages to leak through
  - Replaced `try_read()` with `blocking_read()` in WebSocket event filtering for messages, typing indicators, voice events, and presence updates
  - Previous implementation used `try_read().map(...).unwrap_or(false)` which would fail open on lock contention, allowing blocked users' events through
  - Fix ensures block checks never fail open - will wait for lock rather than returning false on contention
  - Affects MessageNew, TypingStart, TypingStop, VoiceUserJoined, VoiceUserLeft, CallParticipantJoined, CallParticipantLeft, PresenceUpdate, and RichPresenceUpdate events
- Attachment access now enforces guild/DM membership (previously any authenticated user could access any file)
- CORS hardened with configurable origins for production (development mode allows any origin)
- Request-ID header propagation for security tracing and correlation
- MFA verification enforced during login flow
- Markdown HTML output sanitized with DOMPurify to prevent XSS
- Prevented `@everyone` role from being assigned dangerous permissions (e.g., `MANAGE_GUILD`, `BAN_MEMBERS`) via API validation
- XSS hardening for Mermaid SVG rendering (forbid foreignObject, style, script tags)
- Ownership verification in page reorder operations prevents cross-guild attacks
- Fail-fast permission checks on database errors (no silent auth bypass)
- Fixed missing size validation for user avatar uploads (previously relied only on DefaultBodyLimit middleware)

## [0.1.0] - 2026-01-18

### Added
- Permission system with API handlers for admin, roles, and overrides
- Rate limiting middleware with Redis-based tracking and route integration
- Hierarchical AGENTS.md documentation for codebase navigation
- Git workflow design with commit conventions and worktree strategy
- Docker-based test infrastructure with proper database permissions
- Admin panel with two-tier privilege model (base admin + elevated admin)
- System audit logging for compliance and security tracing
- Global user bans and guild suspension capabilities
- System announcements feature

### Changed
- Hardened Docker infrastructure with Bitnami images
- Reworked persona system to concern-based code reviews
- Updated roadmap with Phase 3 status (rate limiting complete)

### Fixed
- File upload and download issues
- Merge conflict resolution from cherry-pick
- Dockerfile path reference in CI workflow
- MinIO image configuration (switched to official minio/minio)
- Bitnami images using :latest tag
- Secondary sort key for stable message ordering
- SQLx test fixtures with proper db permissions
- Code formatting and clippy warnings

[Unreleased]: https://github.com/Wolftown-io/canis/compare/v0.1.0...HEAD
[0.1.0]: https://github.com/Wolftown-io/canis/releases/tag/v0.1.0
