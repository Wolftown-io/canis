# VoiceChat Platform - Technische Architektur

## Architektur-Ãœbersicht

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT LAYER                                    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚    Windows      â”‚  â”‚     Linux       â”‚  â”‚     macOS       â”‚             â”‚
â”‚   â”‚   (Tauri 2.0)   â”‚  â”‚   (Tauri 2.0)   â”‚  â”‚   (Tauri 2.0)   â”‚             â”‚
â”‚   â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚             â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
â”‚   â”‚  â”‚  WebView  â”‚  â”‚  â”‚  â”‚  WebView  â”‚  â”‚  â”‚  â”‚  WebView  â”‚  â”‚             â”‚
â”‚   â”‚  â”‚ (Solid.js)â”‚  â”‚  â”‚  â”‚ (Solid.js)â”‚  â”‚  â”‚  â”‚ (Solid.js)â”‚  â”‚             â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
â”‚   â”‚        â”‚        â”‚  â”‚        â”‚        â”‚  â”‚        â”‚        â”‚             â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚             â”‚
â”‚   â”‚  â”‚Rust Core  â”‚  â”‚  â”‚  â”‚Rust Core  â”‚  â”‚  â”‚  â”‚Rust Core  â”‚  â”‚             â”‚
â”‚   â”‚  â”‚â€¢ WebRTC   â”‚  â”‚  â”‚  â”‚â€¢ WebRTC   â”‚  â”‚  â”‚  â”‚â€¢ WebRTC   â”‚  â”‚             â”‚
â”‚   â”‚  â”‚â€¢ Audio    â”‚  â”‚  â”‚  â”‚â€¢ Audio    â”‚  â”‚  â”‚  â”‚â€¢ Audio    â”‚  â”‚             â”‚
â”‚   â”‚  â”‚â€¢ Crypto   â”‚  â”‚  â”‚  â”‚â€¢ Crypto   â”‚  â”‚  â”‚  â”‚â€¢ Crypto   â”‚  â”‚             â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚            â”‚                    â”‚                    â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚                    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       INTERNET            â”‚
                    â”‚   (TLS 1.3 encrypted)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SERVER LAYER                                       â”‚
â”‚                                 â”‚                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚      API Gateway        â”‚                              â”‚
â”‚                    â”‚   (Reverse Proxy)       â”‚                              â”‚
â”‚                    â”‚   â€¢ TLS Termination     â”‚                              â”‚
â”‚                    â”‚   â€¢ Rate Limiting       â”‚                              â”‚
â”‚                    â”‚   â€¢ Load Balancing      â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                 â”‚                                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚           â”‚                     â”‚                     â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Auth Service   â”‚  â”‚  Chat Service   â”‚  â”‚  Voice Service  â”‚             â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚     (SFU)       â”‚             â”‚
â”‚  â”‚ â€¢ Local Auth    â”‚  â”‚ â€¢ Channels      â”‚  â”‚                 â”‚             â”‚
â”‚  â”‚ â€¢ OIDC/SSO      â”‚  â”‚ â€¢ Messages      â”‚  â”‚ â€¢ mediasoup/    â”‚             â”‚
â”‚  â”‚ â€¢ MFA (TOTP)    â”‚  â”‚ â€¢ File Upload   â”‚  â”‚   webrtc-rs     â”‚             â”‚
â”‚  â”‚ â€¢ Sessions      â”‚  â”‚ â€¢ E2EE (Olm)    â”‚  â”‚ â€¢ Opus Codec    â”‚             â”‚
â”‚  â”‚ â€¢ JWT Tokens    â”‚  â”‚ â€¢ WebSocket     â”‚  â”‚ â€¢ DTLS-SRTP     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                    â”‚                    â”‚                       â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                 â”‚                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚     Data Layer          â”‚                              â”‚
â”‚                    â”‚                         â”‚                              â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                              â”‚
â”‚                    â”‚  â”‚   PostgreSQL    â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Users       â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Channels    â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Messages    â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Permissions â”‚    â”‚                              â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                              â”‚
â”‚                    â”‚                         â”‚                              â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                              â”‚
â”‚                    â”‚  â”‚     Redis       â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Sessions    â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Presence    â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Pub/Sub     â”‚    â”‚                              â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                              â”‚
â”‚                    â”‚                         â”‚                              â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                              â”‚
â”‚                    â”‚  â”‚   S3 Storage    â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Files       â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Avatars     â”‚    â”‚                              â”‚
â”‚                    â”‚  â”‚   â€¢ Backups     â”‚    â”‚                              â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Komponenten-Details

### 1. Client-Architektur (Tauri 2.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TAURI CLIENT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    FRONTEND (WebView)                       â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  Framework: Solid.js                                        â”‚ â”‚
â”‚  â”‚  Styling:   UnoCSS (Tailwind-kompatibel)                   â”‚ â”‚
â”‚  â”‚  State:     Solid Stores + Signals                          â”‚ â”‚
â”‚  â”‚  Icons:     Lucide                                          â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚   Views     â”‚ â”‚ Components  â”‚ â”‚   Stores    â”‚           â”‚ â”‚
â”‚  â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Login     â”‚ â”‚ â€¢ Channel   â”‚ â”‚ â€¢ Auth      â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Channels  â”‚ â”‚ â€¢ Message   â”‚ â”‚ â€¢ Channels  â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Settings  â”‚ â”‚ â€¢ UserList  â”‚ â”‚ â€¢ Messages  â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Voice     â”‚ â”‚ â€¢ VoiceBar  â”‚ â”‚ â€¢ Voice     â”‚           â”‚ â”‚
â”‚  â”‚  â”‚             â”‚ â”‚ â€¢ Settings  â”‚ â”‚ â€¢ Settings  â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚                                    â”‚
â”‚                      Tauri Commands                              â”‚
â”‚                             â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    BACKEND (Rust)                           â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚                   Core Modules                       â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    Audio     â”‚  â”‚   WebRTC     â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚              â”‚  â”‚              â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ cpal       â”‚  â”‚ â€¢ webrtc-rs  â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ opus       â”‚  â”‚ â€¢ Signaling  â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ nnnoiselessâ”‚  â”‚ â€¢ DTLS-SRTP  â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    Crypto    â”‚  â”‚   Network    â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚              â”‚  â”‚              â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ vodozemac  â”‚  â”‚ â€¢ HTTP/REST  â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Key Store  â”‚  â”‚ â€¢ WebSocket  â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Keyring    â”‚  â”‚ â€¢ rustls     â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                      â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Client-Ressourcenziele

| Metrik | Ziel | Discord zum Vergleich |
|--------|------|----------------------|
| RAM (Idle) | <80 MB | ~300-400 MB |
| RAM (Voice aktiv) | <120 MB | ~400-500 MB |
| CPU (Idle) | <1% | ~2-5% |
| CPU (Voice aktiv) | <5% | ~5-10% |
| BinÃ¤rgrÃ¶ÃŸe | <50 MB | ~150 MB |
| Startup | <3s | ~5-10s |

---

### 2. Server-Architektur

#### Auth Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AUTH SERVICE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Endpoints:                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚  POST   /auth/register          Lokale User-Registrierung       â”‚
â”‚  POST   /auth/login             Login (lokal oder SSO Start)    â”‚
â”‚  POST   /auth/logout            Session beenden                  â”‚
â”‚  POST   /auth/refresh           Access Token erneuern            â”‚
â”‚  GET    /auth/oidc/callback     SSO Callback Handler             â”‚
â”‚  POST   /auth/mfa/setup         TOTP Setup                       â”‚
â”‚  POST   /auth/mfa/verify        TOTP Verifizierung               â”‚
â”‚                                                                  â”‚
â”‚  Interne Funktionen:                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚  â€¢ Password Hashing (Argon2id)                                   â”‚
â”‚  â€¢ JWT Generation/Validation                                     â”‚
â”‚  â€¢ Session Management (Redis)                                    â”‚
â”‚  â€¢ OIDC Provider Integration                                     â”‚
â”‚  â€¢ JIT User Provisioning                                         â”‚
â”‚                                                                  â”‚
â”‚  Token-Strategie:                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚  â€¢ Access Token:  JWT, 15 min GÃ¼ltigkeit                        â”‚
â”‚  â€¢ Refresh Token: Opaque, 7 Tage, in Redis                      â”‚
â”‚  â€¢ Session:       Redis mit User-Metadata                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Chat Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CHAT SERVICE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  REST Endpoints:                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚  GET    /channels                    Liste aller Channels        â”‚
â”‚  POST   /channels                    Channel erstellen           â”‚
â”‚  GET    /channels/:id                Channel Details             â”‚
â”‚  PATCH  /channels/:id                Channel bearbeiten          â”‚
â”‚  DELETE /channels/:id                Channel lÃ¶schen             â”‚
â”‚  GET    /channels/:id/messages       Nachrichten laden           â”‚
â”‚  POST   /channels/:id/messages       Nachricht senden            â”‚
â”‚  PATCH  /messages/:id                Nachricht bearbeiten        â”‚
â”‚  DELETE /messages/:id                Nachricht lÃ¶schen           â”‚
â”‚  POST   /upload                      Datei hochladen             â”‚
â”‚                                                                  â”‚
â”‚  WebSocket Events (Signaling):                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  â†’ message.new          Neue Nachricht                           â”‚
â”‚  â†’ message.edit         Nachricht bearbeitet                     â”‚
â”‚  â†’ message.delete       Nachricht gelÃ¶scht                       â”‚
â”‚  â†’ typing.start         User tippt                               â”‚
â”‚  â†’ typing.stop          User tippt nicht mehr                    â”‚
â”‚  â†’ presence.update      Online-Status geÃ¤ndert                   â”‚
â”‚  â†’ channel.update       Channel-Ã„nderung                         â”‚
â”‚                                                                  â”‚
â”‚  E2EE Integration:                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  â€¢ Olm Sessions fÃ¼r 1:1 DMs                                      â”‚
â”‚  â€¢ Megolm Sessions fÃ¼r Gruppen-Channels                          â”‚
â”‚  â€¢ Key Exchange Ã¼ber separaten Kanal                             â”‚
â”‚  â€¢ Server speichert nur verschlÃ¼sselte Nachrichten               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Voice Service (SFU)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      VOICE SERVICE (SFU)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Architektur: Selective Forwarding Unit                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚                                                                  â”‚
â”‚     Client A          SFU Server           Client B              â”‚
â”‚        â”‚                  â”‚                   â”‚                  â”‚
â”‚        â”‚â”€â”€â”€â”€ Offer â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                  â”‚
â”‚        â”‚â—„â”€â”€â”€ Answer â”€â”€â”€â”€â”€â”€â”‚                   â”‚                  â”‚
â”‚        â”‚                  â”‚                   â”‚                  â”‚
â”‚        â”‚==== Media =======â”‚======= Media ====â–ºâ”‚                  â”‚
â”‚        â”‚â—„=== Media =======â”‚â—„====== Media =====â”‚                  â”‚
â”‚        â”‚                  â”‚                   â”‚                  â”‚
â”‚                                                                  â”‚
â”‚  Der SFU:                                                        â”‚
â”‚  â€¢ EmpfÃ¤ngt Media von jedem Client einmal                        â”‚
â”‚  â€¢ Leitet an alle anderen Clients weiter                         â”‚
â”‚  â€¢ Kein Mixing/Transcoding (CPU-effizient)                       â”‚
â”‚  â€¢ Skaliert besser als Mesh fÃ¼r >4 User                          â”‚
â”‚                                                                  â”‚
â”‚  WebRTC Signaling (JSON-RPC Ã¼ber WebSocket):                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚  â†’ voice.join           Voice-Channel beitreten                  â”‚
â”‚  â†’ voice.leave          Voice-Channel verlassen                  â”‚
â”‚  â†’ voice.offer          SDP Offer                                â”‚
â”‚  â†’ voice.answer         SDP Answer                               â”‚
â”‚  â†’ voice.ice            ICE Candidate                            â”‚
â”‚  â†’ voice.mute           Selbst muten                             â”‚
â”‚  â†’ voice.unmute         Selbst unmuten                           â”‚
â”‚  â† voice.user_joined    User ist beigetreten                     â”‚
â”‚  â† voice.user_left      User hat verlassen                       â”‚
â”‚  â† voice.speaking       User spricht                             â”‚
â”‚                                                                  â”‚
â”‚  Audio Pipeline:                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚  Capture â†’ Opus Encode â†’ SRTP Encrypt â†’ Network                  â”‚
â”‚  Network â†’ SRTP Decrypt â†’ Opus Decode â†’ Playback                 â”‚
â”‚                                                                  â”‚
â”‚  Konfigurierbare Parameter:                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚  â€¢ Opus Bitrate: 24-96 kbps (default: 64 kbps)                  â”‚
â”‚  â€¢ Opus Frame Size: 10-60 ms (default: 20 ms)                   â”‚
â”‚  â€¢ Max Users pro Channel: 50-100 (default: 50)                  â”‚
â”‚  â€¢ Jitter Buffer: 20-200 ms (adaptive)                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. Datenbank-Schema (Ãœbersicht)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATABASE SCHEMA                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚    users     â”‚       â”‚   sessions   â”‚                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚  â”‚ id (UUID)    â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ user_id      â”‚                        â”‚
â”‚  â”‚ username     â”‚       â”‚ token_hash   â”‚                        â”‚
â”‚  â”‚ display_name â”‚       â”‚ expires_at   â”‚                        â”‚
â”‚  â”‚ email        â”‚       â”‚ ip_address   â”‚                        â”‚
â”‚  â”‚ password_hashâ”‚       â”‚ user_agent   â”‚                        â”‚
â”‚  â”‚ auth_method  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚  â”‚ external_id  â”‚                                                â”‚
â”‚  â”‚ avatar_url   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ status       â”‚       â”‚  user_keys   â”‚                        â”‚
â”‚  â”‚ mfa_secret   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚  â”‚ created_at   â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ user_id      â”‚                        â”‚
â”‚  â”‚ updated_at   â”‚       â”‚ identity_key â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ signed_prekeyâ”‚                        â”‚
â”‚         â”‚               â”‚ one_time_keysâ”‚                        â”‚
â”‚         â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚         â”‚               â”‚   channels   â”‚                        â”‚
â”‚         â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚         â”‚               â”‚ id (UUID)    â”‚                        â”‚
â”‚         â”‚               â”‚ name         â”‚                        â”‚
â”‚         â”‚               â”‚ type         â”‚â—„â”€â”€â”€ voiceâ”‚textâ”‚dm      â”‚
â”‚         â”‚               â”‚ category_id  â”‚                        â”‚
â”‚         â”‚               â”‚ position     â”‚                        â”‚
â”‚         â”‚               â”‚ topic        â”‚                        â”‚
â”‚         â”‚               â”‚ user_limit   â”‚                        â”‚
â”‚         â”‚               â”‚ created_at   â”‚                        â”‚
â”‚         â”‚               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â”‚                      â”‚                                 â”‚
â”‚         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚     â”‚                â”‚                â”‚               â”‚
â”‚         â–¼     â–¼                â–¼                â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ channel_     â”‚       â”‚   messages   â”‚ â”‚   megolm_    â”‚       â”‚
â”‚  â”‚ members      â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   sessions   â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚ id (UUID)    â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ channel_id   â”‚       â”‚ channel_id   â”‚ â”‚ channel_id   â”‚       â”‚
â”‚  â”‚ user_id      â”‚       â”‚ user_id      â”‚ â”‚ session_id   â”‚       â”‚
â”‚  â”‚ role_id      â”‚       â”‚ content_enc  â”‚â—„â”€ verschlÃ¼sseltâ”‚       â”‚
â”‚  â”‚ joined_at    â”‚       â”‚ nonce        â”‚ â”‚ sender_key   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ reply_to     â”‚ â”‚ created_at   â”‚       â”‚
â”‚                         â”‚ edited_at    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ created_at   â”‚                        â”‚
â”‚  â”‚    roles     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                â”‚
â”‚  â”‚ id (UUID)    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ name         â”‚       â”‚    files     â”‚                        â”‚
â”‚  â”‚ color        â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚  â”‚ permissions  â”‚â—„â”€ JSONBâ”‚ id (UUID)    â”‚                        â”‚
â”‚  â”‚ position     â”‚       â”‚ message_id   â”‚                        â”‚
â”‚  â”‚ created_at   â”‚       â”‚ filename     â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ mime_type    â”‚                        â”‚
â”‚                         â”‚ size_bytes   â”‚                        â”‚
â”‚                         â”‚ s3_key       â”‚                        â”‚
â”‚                         â”‚ created_at   â”‚                        â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. VerschlÃ¼sselungsarchitektur

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ENCRYPTION ARCHITECTURE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  LAYER 1: Transport (alle Verbindungen)                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚
â”‚                                                                  â”‚
â”‚  Client â—„â”€â”€â”€â”€â”€â”€ TLS 1.3 â”€â”€â”€â”€â”€â”€â–º Server                          â”‚
â”‚                                                                  â”‚
â”‚  â€¢ Alle HTTP/WebSocket Verbindungen                              â”‚
â”‚  â€¢ Certificate Pinning im Client (optional)                      â”‚
â”‚  â€¢ rustls fÃ¼r Implementation                                     â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  LAYER 2: Voice (WebRTC)                                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚
â”‚                                                                  â”‚
â”‚  MVP: DTLS-SRTP                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚Client A â”‚â—„â”€DTLSâ”€â”€â–ºâ”‚   SFU   â”‚â—„â”€DTLSâ”€â”€â–ºâ”‚Client B â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  SRTP   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  SRTP   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                          â”‚                                       â”‚
â”‚                    Server sieht                                  â”‚
â”‚                    Media (trusted)                               â”‚
â”‚                                                                  â”‚
â”‚  SpÃ¤ter (Paranoid Mode): MLS                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚Client A â”‚â—„â”€MLSâ”€â”€â”€â”€â”‚   SFU   â”‚â”€â”€â”€â”€MLSâ”€â–ºâ”‚Client B â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ E2EE    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  E2EE   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                          â”‚                                       â”‚
â”‚                    Server sieht                                  â”‚
â”‚                    nur Ciphertext                                â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  LAYER 3: Text Messages                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚
â”‚                                                                  â”‚
â”‚  1:1 Direct Messages: Olm (Double Ratchet)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ User A  â”‚                              â”‚ User B  â”‚           â”‚
â”‚  â”‚         â”‚                              â”‚         â”‚           â”‚
â”‚  â”‚ Olm     â”‚â—„â”€â”€â”€â”€â”€â”€ Encrypted â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Olm     â”‚           â”‚
â”‚  â”‚ Session â”‚        Messages              â”‚ Session â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚       â”‚                                        â”‚                 â”‚
â”‚       â””â”€â”€â”€â–º X3DH Key Agreement â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚             (One-time Prekeys)                                   â”‚
â”‚                                                                  â”‚
â”‚  Group Channels: Megolm                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ User A  â”‚   â”‚ User B  â”‚   â”‚ User C  â”‚                       â”‚
â”‚  â”‚         â”‚   â”‚         â”‚   â”‚         â”‚                       â”‚
â”‚  â”‚ Megolm  â”‚   â”‚ Megolm  â”‚   â”‚ Megolm  â”‚                       â”‚
â”‚  â”‚ Outboundâ”‚   â”‚ Inbound â”‚   â”‚ Inbound â”‚                       â”‚
â”‚  â”‚ Session â”‚   â”‚ Session â”‚   â”‚ Session â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                       â”‚
â”‚       â”‚             â”‚             â”‚                              â”‚
â”‚       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”     â”‚                              â”‚
â”‚       â””â”€â”€â”€â”€â–ºâ”‚ Shared Sessionâ”‚â—„â”€â”€â”€â”€â”˜                              â”‚
â”‚             â”‚ (Ratchets     â”‚                                    â”‚
â”‚             â”‚  forward only)â”‚                                    â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                  â”‚
â”‚  Key Distribution:                                              â”‚
â”‚  â€¢ Olm Sessions zum sicheren Key-Austausch                      â”‚
â”‚  â€¢ Megolm Session Keys via Olm verteilt                          â”‚
â”‚  â€¢ Bei User Join/Leave: Key Rotation                             â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  LAYER 4: Data at Rest                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚
â”‚                                                                  â”‚
â”‚  â€¢ Messages: Bereits E2EE verschlÃ¼sselt gespeichert             â”‚
â”‚  â€¢ Files: AES-256-GCM vor S3 Upload                             â”‚
â”‚  â€¢ Backups: VerschlÃ¼sselt mit Server-Key                        â”‚
â”‚  â€¢ User Keys: Im OS Keychain (Client-side)                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. SSO/Identity Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IDENTITY ARCHITECTURE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                     â”‚    User Request     â”‚                     â”‚
â”‚                     â”‚   "Login with SSO"  â”‚                     â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                â”‚                                 â”‚
â”‚                                â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     Auth Service                             â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚  Local Auth     â”‚         â”‚    OIDC Handler         â”‚   â”‚â”‚
â”‚  â”‚  â”‚                 â”‚         â”‚                         â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Username/Pass â”‚         â”‚ â€¢ Discovery             â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢ Argon2id      â”‚         â”‚ â€¢ Authorization URL     â”‚   â”‚â”‚
â”‚  â”‚  â”‚ â€¢ TOTP MFA      â”‚         â”‚ â€¢ Token Exchange        â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â€¢ UserInfo Endpoint     â”‚   â”‚â”‚
â”‚  â”‚           â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚           â”‚                               â”‚                 â”‚â”‚
â”‚  â”‚           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚â”‚
â”‚  â”‚           â”‚         â”‚                                        â”‚â”‚
â”‚  â”‚           â”‚         â–¼                                        â”‚â”‚
â”‚  â”‚           â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚           â”‚    â”‚           SSO Providers                â”‚   â”‚â”‚
â”‚  â”‚           â”‚    â”‚                                        â”‚   â”‚â”‚
â”‚  â”‚           â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚â”‚
â”‚  â”‚           â”‚    â”‚  â”‚Authentik â”‚ â”‚ Keycloak â”‚ â”‚Azure ADâ”‚ â”‚   â”‚â”‚
â”‚  â”‚           â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚â”‚
â”‚  â”‚           â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚â”‚
â”‚  â”‚           â”‚    â”‚  â”‚  Okta    â”‚ â”‚  Google  â”‚ â”‚  LDAP  â”‚ â”‚   â”‚â”‚
â”‚  â”‚           â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚â”‚
â”‚  â”‚           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â”‚           â”‚                        â”‚                        â”‚â”‚
â”‚  â”‚           â–¼                        â–¼                        â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚              Unified User Store                       â”‚  â”‚â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚â”‚
â”‚  â”‚  â”‚  user_id:        UUID (internal)                      â”‚  â”‚â”‚
â”‚  â”‚  â”‚  auth_method:    local | oidc                         â”‚  â”‚â”‚
â”‚  â”‚  â”‚  external_id:    SSO Subject (if OIDC)               â”‚  â”‚â”‚
â”‚  â”‚  â”‚  provider:       authentik | keycloak | ... (if OIDC)â”‚  â”‚â”‚
â”‚  â”‚  â”‚  username:       Unique, for mentions                 â”‚  â”‚â”‚
â”‚  â”‚  â”‚  display_name:   From SSO or user-set                 â”‚  â”‚â”‚
â”‚  â”‚  â”‚  email:          From SSO or user-set                 â”‚  â”‚â”‚
â”‚  â”‚  â”‚  avatar_url:     From SSO or uploaded                 â”‚  â”‚â”‚
â”‚  â”‚  â”‚  roles:          Mapped from SSO groups               â”‚  â”‚â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  SSO Attribute Mapping (konfigurierbar):                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚  display_name:  preferred_username â†’ name â†’ email               â”‚
â”‚  avatar:        picture â†’ avatar_url â†’ (none)                   â”‚
â”‚  email:         email                                            â”‚
â”‚  groups:        groups â†’ roles â†’ (none)                         â”‚
â”‚                                                                  â”‚
â”‚  JIT Provisioning Flow:                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚  1. User klickt "Login with SSO"                                â”‚
â”‚  2. Redirect zu OIDC Provider                                   â”‚
â”‚  3. User authentifiziert sich                                   â”‚
â”‚  4. Callback mit Authorization Code                             â”‚
â”‚  5. Token Exchange fÃ¼r ID Token                                 â”‚
â”‚  6. UserInfo abrufen                                            â”‚
â”‚  7. User existiert? â†’ Session erstellen                         â”‚
â”‚     User neu? â†’ Profil erstellen, dann Session                  â”‚
â”‚  8. Redirect zu App mit Session Cookie                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6. Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DOCKER DEPLOYMENT                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  docker-compose.yml                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    Docker Network                            â”‚â”‚
â”‚  â”‚                   (voicechat_net)                            â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚â”‚
â”‚  â”‚  â”‚   Traefik    â”‚ â—„â”€â”€â”€ Port 443 (HTTPS)                     â”‚â”‚
â”‚  â”‚  â”‚  (Reverse    â”‚ â—„â”€â”€â”€ Port 80 (HTTP â†’ HTTPS Redirect)      â”‚â”‚
â”‚  â”‚  â”‚   Proxy)     â”‚                                           â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚â”‚
â”‚  â”‚         â”‚                                                    â”‚â”‚
â”‚  â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚â”‚
â”‚  â”‚         â”‚                  â”‚                 â”‚              â”‚â”‚
â”‚  â”‚         â–¼                  â–¼                 â–¼              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚â”‚
â”‚  â”‚  â”‚ voicechat-   â”‚  â”‚ voicechat-   â”‚  â”‚ voicechat-   â”‚      â”‚â”‚
â”‚  â”‚  â”‚ api          â”‚  â”‚ voice        â”‚  â”‚ web          â”‚      â”‚â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ (optional)   â”‚      â”‚â”‚
â”‚  â”‚  â”‚ Auth + Chat  â”‚  â”‚ SFU Server   â”‚  â”‚ Static Files â”‚      â”‚â”‚
â”‚  â”‚  â”‚ Services     â”‚  â”‚ WebRTC       â”‚  â”‚              â”‚      â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚â”‚
â”‚  â”‚         â”‚                 â”‚                                  â”‚â”‚
â”‚  â”‚         â”‚                 â”‚  UDP Ports: 10000-10100          â”‚â”‚
â”‚  â”‚         â”‚                 â”‚  (WebRTC Media)                  â”‚â”‚
â”‚  â”‚         â”‚                 â”‚                                  â”‚â”‚
â”‚  â”‚         â–¼                 â”‚                                  â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                                  â”‚â”‚
â”‚  â”‚  â”‚   Redis      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚â”‚
â”‚  â”‚  â”‚              â”‚                                           â”‚â”‚
â”‚  â”‚  â”‚ Sessions,    â”‚                                           â”‚â”‚
â”‚  â”‚  â”‚ Presence,    â”‚                                           â”‚â”‚
â”‚  â”‚  â”‚ Pub/Sub      â”‚                                           â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚â”‚
â”‚  â”‚         â”‚                                                    â”‚â”‚
â”‚  â”‚         â–¼                                                    â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚â”‚
â”‚  â”‚  â”‚  PostgreSQL  â”‚                                           â”‚â”‚
â”‚  â”‚  â”‚              â”‚                                           â”‚â”‚
â”‚  â”‚  â”‚ Persistent   â”‚                                           â”‚â”‚
â”‚  â”‚  â”‚ Data         â”‚                                           â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  Volumes:                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚  â€¢ postgres_data    - Datenbank-Persistenz                      â”‚
â”‚  â€¢ redis_data       - Redis Persistenz (optional)               â”‚
â”‚  â€¢ uploads          - Lokale Datei-Uploads (oder S3)            â”‚
â”‚  â€¢ certs            - TLS Zertifikate (wenn nicht Let's Encrypt)â”‚
â”‚                                                                  â”‚
â”‚  Externe Verbindungen:                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ S3-kompatibles Storage (MinIO, Backblaze, AWS)               â”‚
â”‚  â€¢ SMTP Server (fÃ¼r E-Mail-Benachrichtigungen)                  â”‚
â”‚  â€¢ OIDC Provider (Authentik, Keycloak, etc.)                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 7. Backup & Recovery

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKUP ARCHITECTURE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Backup-Komponenten:                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚                                                                  â”‚
â”‚  1. PostgreSQL Database                                         â”‚
â”‚     â€¢ pg_dump tÃ¤glich um 03:00 UTC                              â”‚
â”‚     â€¢ WAL Archiving fÃ¼r Point-in-Time Recovery                  â”‚
â”‚     â€¢ Retention: 30 Tage                                        â”‚
â”‚                                                                  â”‚
â”‚  2. Uploaded Files                                              â”‚
â”‚     â€¢ S3 Sync/Versioning                                        â”‚
â”‚     â€¢ Oder: tar + encrypt bei lokalem Storage                   â”‚
â”‚                                                                  â”‚
â”‚  3. Configuration                                               â”‚
â”‚     â€¢ docker-compose.yml                                        â”‚
â”‚     â€¢ .env Dateien (verschlÃ¼sselt)                              â”‚
â”‚     â€¢ TLS Zertifikate                                           â”‚
â”‚                                                                  â”‚
â”‚  Backup-Flow:                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Cronjob    â”‚â”€â”€â”€â”€â–ºâ”‚  Backup     â”‚â”€â”€â”€â”€â–ºâ”‚  S3 Bucket  â”‚       â”‚
â”‚  â”‚  (03:00)    â”‚     â”‚  Script     â”‚     â”‚             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                             â”‚                    â”‚               â”‚
â”‚                             â”‚              Lifecycle             â”‚
â”‚                             â”‚              Policy                â”‚
â”‚                             â”‚                    â”‚               â”‚
â”‚                             â–¼                    â–¼               â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                      â”‚   Encrypt   â”‚     â”‚   Delete    â”‚        â”‚
â”‚                      â”‚  AES-256    â”‚     â”‚   after     â”‚        â”‚
â”‚                      â”‚             â”‚     â”‚   30 days   â”‚        â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                  â”‚
â”‚  Restore-Prozess:                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚                                                                  â”‚
â”‚  $ ./scripts/restore.sh --from s3://bucket/backup-2024-01-15    â”‚
â”‚                                                                  â”‚
â”‚  1. Services stoppen                                            â”‚
â”‚  2. Backup herunterladen + entschlÃ¼sseln                        â”‚
â”‚  3. PostgreSQL restore                                          â”‚
â”‚  4. Files restore                                               â”‚
â”‚  5. Services starten                                            â”‚
â”‚  6. Health Check                                                â”‚
â”‚                                                                  â”‚
â”‚  RTO (Recovery Time Objective): < 30 Minuten                    â”‚
â”‚  RPO (Recovery Point Objective): < 24 Stunden                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technical Debt & Known Issues

*Last reviewed: 2026-01-08*

### Critical: N+1 Query in Message List Handler

**Location:** `server/src/chat/messages.rs:133-163`

The `list()` handler fetches author info individually for each message:

```rust
for msg in messages {
    let author = db::find_user_by_id(&state.db, msg.user_id).await?;
}
```

**Impact:** 100 messages = 101 database queries. This will cause performance issues at scale.

**Recommendation:** Add batch user lookup:
```rust
pub async fn find_users_by_ids(pool: &PgPool, ids: &[Uuid]) -> HashMap<Uuid, User>
```

**Priority:** Critical - fix before production

---

### Medium: Duplicated AuthorProfile Construction

**Location:** `server/src/chat/messages.rs` (lines 135-150, 212-227, 274-289)

Profile construction logic is repeated in `list`, `create`, and `update` handlers.

**Recommendation:** Add `From<User> for AuthorProfile` and `AuthorProfile::deleted(id)` factory.

**Priority:** High - reduces maintenance burden

---

### Medium: Status Serialization Fragility

**Location:** `server/src/chat/messages.rs:142`

```rust
status: format!("{:?}", u.status).to_lowercase()
```

Using Debug formatting for API output couples wire format to Rust internals.

**Recommendation:** Add explicit `UserStatus::as_str()` method.

**Priority:** Medium - breaking change if enum changes

---

### Low: Missing Channel Access Control

**Location:** `server/src/chat/messages.rs:117-126`

The `list` endpoint checks channel existence but not user membership.

**Status:** May be intentional for public community servers. Needs explicit documentation.

**Priority:** Low - document or implement based on requirements

---

### Low: No Rate Limiting

No rate limiting on API endpoints or WebSocket messages.

**Recommendation:** Add tower-governor for HTTP, per-user limits for WebSocket.

**Priority:** Medium for production - prevents abuse

---

## Persona Review Summary (2026-01-08)

### Elrond (Architecture)

**Verdict:** Fundamental approach is sound. Embedding author profiles in message responses is the right UX decision.

**Key Concerns:**
1. N+1 query pattern must be fixed before production
2. Consider introducing `UserProfileService` abstraction for presence features
3. API response shape should plan for future features (roles, badges)

### Faramir (Security)

**Verdict:** Auth middleware is correctly applied. JWT validation is sound.

**Key Concerns:**
1. Rate limiting is missing on all endpoints
2. Channel access control is not enforced
3. Add audit logging for sensitive operations
4. Consider token revocation mechanism

### Éowyn (Code Quality)

**Verdict:** Code is readable and follows project patterns.

**Key Concerns:**
1. DRY violation in AuthorProfile construction
2. Status serialization should use explicit method
3. Error types are well-structured with thiserror

### Legolas (Testing)

**Verdict:** No tests exist for message handlers.

**Key Concerns:**
1. Add integration tests for message CRUD
2. Test WebSocket broadcast on message events
3. Add performance tests for message list pagination

---

## Referenzen

- [PROJECT_SPEC.md](../project/specification.md) - Projektanforderungen
- [STANDARDS.md](../development/standards.md) - Verwendete Standards
- [LICENSE_COMPLIANCE.md](../ops/license-compliance.md) - LizenzprÃ¼fung
