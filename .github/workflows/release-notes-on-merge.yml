name: Release Notes On Merge

on:
  pull_request:
    types: [closed]
    branches: [main]

jobs:
  release-notes-preview:
    name: Release Notes Preview
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - uses: actions/checkout@v4
        with:
          ref: main

      - name: Validate docs governance consistency
        run: python3 scripts/check_docs_governance.py

      - name: Generate standardized release notes preview
        env:
          VERSION: pr-merge-${{ github.event.pull_request.number }}
        run: python3 scripts/generate_release_notes.py --version "$VERSION" --output /tmp/release-notes.md

      - name: Add release notes to workflow summary
        run: |
          echo "# Release Notes Preview" >> "$GITHUB_STEP_SUMMARY"
          echo "" >> "$GITHUB_STEP_SUMMARY"
          cat /tmp/release-notes.md >> "$GITHUB_STEP_SUMMARY"

      - name: Upload release notes artifact
        uses: actions/upload-artifact@v4
        with:
          name: release-notes-preview-pr-${{ github.event.pull_request.number }}
          path: /tmp/release-notes.md
