# VoiceChat Production Environment Configuration
# Copy to .env and configure before running docker compose
#
# Usage:
#   cp .env.example .env
#   # Edit .env with your values
#   cd infra/compose && docker compose up -d

# =============================================================================
# Required Configuration
# =============================================================================

# Domain for your VoiceChat instance (used by Traefik for SSL)
DOMAIN=chat.yourdomain.com

# PostgreSQL password (generate with: openssl rand -base64 24)
POSTGRES_PASSWORD=changeme_random_password_here

# JWT signing secret (generate with: openssl rand -hex 32)
JWT_SECRET=changeme_random_secret_here

# Email for Let's Encrypt SSL certificates
ACME_EMAIL=admin@yourdomain.com

# =============================================================================
# Valkey Configuration
# =============================================================================

# Valkey password (leave empty for no password in dev)
# Note: Valkey is a BSD-3-Clause licensed fork of Redis, fully API-compatible
VALKEY_PASSWORD=
ALLOW_EMPTY_PASSWORD=yes

# =============================================================================
# Authentication
# =============================================================================

# JWT token expiry in seconds
JWT_ACCESS_EXPIRY=900        # 15 minutes
JWT_REFRESH_EXPIRY=604800    # 7 days

# MFA encryption key (32-byte hex string, generate with: openssl rand -hex 32)
MFA_ENCRYPTION_KEY=

# =============================================================================
# OIDC/SSO Configuration (Optional)
# =============================================================================

OIDC_ISSUER_URL=
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=

# =============================================================================
# Storage Configuration
# =============================================================================

# S3-compatible endpoint (leave empty for AWS S3)
S3_ENDPOINT=
S3_BUCKET=voicechat
S3_PRESIGN_EXPIRY=3600

# Maximum upload size in bytes (default: 50MB)
MAX_UPLOAD_SIZE=52428800

# =============================================================================
# WebRTC Configuration
# =============================================================================

# STUN server for NAT traversal
STUN_SERVER=stun:stun.l.google.com:19302

# TURN server for relaying (recommended for production)
TURN_SERVER=
TURN_USERNAME=
TURN_CREDENTIAL=

# Your server's public IP (auto-detected if not set)
PUBLIC_IP=

# RTP port range for voice
RTP_PORT_MIN=10000
RTP_PORT_MAX=10100

# =============================================================================
# Rate Limiting
# =============================================================================

# Enable rate limiting (recommended: true)
RATE_LIMIT_ENABLED=true

# Trust X-Forwarded-For headers (true if behind Traefik/reverse proxy)
RATE_LIMIT_TRUST_PROXY=true

# IP allowlist (comma-separated, bypasses rate limiting)
RATE_LIMIT_ALLOWLIST=

# Per-category limits (format: requests,window_secs)
# Uncomment to override defaults:
# RATE_LIMIT_AUTH_LOGIN=3,60
# RATE_LIMIT_AUTH_REGISTER=5,60
# RATE_LIMIT_READ=200,60
# RATE_LIMIT_WRITE=30,60

# Failed auth blocking (format: max_failures,block_duration_secs,window_secs)
# RATE_LIMIT_FAILED_AUTH=10,900,300
