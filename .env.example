# VoiceChat Production Environment Configuration
# Copy to .env and configure before running docker compose
#
# Usage:
#   cp .env.example .env
#   # Edit .env with your values
#   cd infra/compose && docker compose up -d

# =============================================================================
# Required Configuration
# =============================================================================

# Domain for your VoiceChat instance (used by Traefik for SSL)
DOMAIN=chat.yourdomain.com

# PostgreSQL password (generate with: openssl rand -base64 24)
POSTGRES_PASSWORD=changeme_random_password_here

# JWT signing secret (generate with: openssl rand -hex 32)
JWT_SECRET=changeme_random_secret_here

# Email for Let's Encrypt SSL certificates
ACME_EMAIL=admin@yourdomain.com

# =============================================================================
# Valkey Configuration
# =============================================================================

# Valkey password (leave empty for no password in dev)
# Note: Valkey is a BSD-3-Clause licensed fork of Redis, fully API-compatible
VALKEY_PASSWORD=
ALLOW_EMPTY_PASSWORD=yes

# =============================================================================
# Authentication
# =============================================================================

# JWT token expiry in seconds
JWT_ACCESS_EXPIRY=900        # 15 minutes
JWT_REFRESH_EXPIRY=604800    # 7 days

# MFA encryption key (32-byte hex string, generate with: openssl rand -hex 32)
MFA_ENCRYPTION_KEY=

# =============================================================================
# OIDC/SSO Configuration (Optional)
# =============================================================================

OIDC_ISSUER_URL=
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=

# =============================================================================
# Storage Configuration
# =============================================================================

# S3-compatible endpoint (leave empty for AWS S3)
S3_ENDPOINT=
S3_BUCKET=voicechat
S3_PRESIGN_EXPIRY=3600

# File upload size limits (in bytes)
# Uncomment and modify to override defaults shown below:
# MAX_UPLOAD_SIZE=52428800        # Default: 50MB for file attachments
# MAX_AVATAR_SIZE=5242880         # Default: 5MB for user/DM avatars
# MAX_EMOJI_SIZE=262144           # Default: 256KB for guild emojis

# IMPORTANT: Upload validation happens in multiple layers:
# 1. Route-specific middleware (avatar route uses MAX_AVATAR_SIZE)
# 2. Global DefaultBodyLimit middleware (uses MAX_UPLOAD_SIZE for all endpoints)
# 3. Handler validation (provides user-friendly error messages with file size)
#
# Example: To allow 10MB avatars while keeping 50MB for attachments:
#   MAX_UPLOAD_SIZE=52428800      # Global middleware limit (â‰¥ all other limits)
#   MAX_AVATAR_SIZE=10485760      # Avatar route and handler limit (10MB)
#   MAX_EMOJI_SIZE=262144         # Emoji handler limit (256KB, uses global middleware)
#
# All limits are now dynamic and configurable via environment variables.
# Avatar uploads will respect MAX_AVATAR_SIZE at both middleware and handler levels.

# =============================================================================
# WebRTC Configuration
# =============================================================================

# STUN server for NAT traversal
STUN_SERVER=stun:stun.l.google.com:19302

# TURN server for relaying (recommended for production)
TURN_SERVER=
TURN_USERNAME=
TURN_CREDENTIAL=

# Your server's public IP (auto-detected if not set)
PUBLIC_IP=

# RTP port range for voice
RTP_PORT_MIN=10000
RTP_PORT_MAX=10100

# =============================================================================
# Rate Limiting
# =============================================================================

# Enable rate limiting (recommended: true)
RATE_LIMIT_ENABLED=true

# Trust X-Forwarded-For headers (true if behind Traefik/reverse proxy)
RATE_LIMIT_TRUST_PROXY=true

# IP allowlist (comma-separated, bypasses rate limiting)
RATE_LIMIT_ALLOWLIST=

# Per-category limits (format: requests,window_secs)
# Uncomment to override defaults:
# RATE_LIMIT_AUTH_LOGIN=3,60
# RATE_LIMIT_AUTH_REGISTER=5,60
# RATE_LIMIT_READ=200,60
# RATE_LIMIT_WRITE=30,60

# Failed auth blocking (format: max_failures,block_duration_secs,window_secs)
# RATE_LIMIT_FAILED_AUTH=10,900,300
